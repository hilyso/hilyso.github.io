---
title: K8S (二) ---  标签以及标签选择器
date: 2025-09-25 15:37:00
categories: 
- [K8S]
tags: 
- K8S
- Deployment
- Daemonset
- StatefulSet
- Replicas
- Job
- CronJob
- Label Selector
---


> 在Kubernetes 中，标签（Labels）是键值对，用于标识和组织资源（如Pod），而控制器（如Deployment、ReplicaSet、DaemonSet等）通过标签选择器（Label Selectors）来决定管理哪些Pod。标签判断的核心机制是基于匹配规则进行的。

## 一、 标签 (Label)

- 标签是任意的 key=value 的键值对，由用户定义, 用来标记 K8s 资源（Pod、Service、Deployment等） 
- Pod可以有多个标签, 例如一个 Pod 的 `metadata.labels`可能如下:

  ``` yaml
  labels:
    app: myapp
    env: production
    tier: backend
  ```

  这些标签是任意的键值对，由用户定义


## 二、 标签选择器 (Label Selectors)

- 控制器在spec.selector中定义选择器，用于过滤 Pod
- 选择器有两种, `matchLabels`, `matchExpressions`

### 2.1 matchLabels 精准匹配

  ``` yaml
  selector:
    matchLabels:
      app: myapp
      env: production
  ```

标识具有且仅具有 `app=myapp` 和 `env=production` 的 pod 


### 2.2 matchExpressions 基于集合的选择器

- `In`: 在集合中
- `NotIn`: 不在集合中
- `Exists`: 只要存在该 key 即可
- `DoesNotExist`： 只要不存在该 key 即可

  ``` yaml
  matchExpressions:
  - key: env
    operator: In
    values: ["prod", "staging"]
  ```

  匹配 `env=prod` 或 `env=staging` 的 Pod

  ``` yaml
  selector:
    matchExpressions:
      - key: tier
        operator: In
        values: [backend, frontend]
      - key: env
        operator: Exists
  ```

  匹配 `tier=backend` 或 `tier=frontend` 且 `env` 标签存在的


  ``` yaml
  selector:
  matchLabels:
    component: redis
  matchExpressions:
    - { key: tier, operator: In, values: [cache] }
    - { key: env, operator: NotIn, values: [dev] }
  ```

  匹配 `component=redis`且 `tier=cache`且 `env!=dev`